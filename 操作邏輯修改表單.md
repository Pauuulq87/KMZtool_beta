# 這份表單是用戶進行測試後發現的問題，並提出修改建議
修改完畢後請在[] 中填寫[已修改]

- [已修改] 地圖中間的提示[開始繪製區域]視窗，建立一個關閉的x按鈕，使用者點擊後可以關閉視窗
- [已修改] 右側面板中的簡易單元，[產生任務]按鈕，名稱改為[產生路徑]，功能保持不變
    - [已修改] 重疊率滑桿，下方再新增一個滑桿，名稱為[旋轉路徑]，滑桿節點預設在最左側，使用者可以拖曳滑桿節點來調整旋轉角度，最左側調到最右側後路徑剛好轉一圈360度。簡單的描述文自由你發想。
- [已修改] 頁首的單元教學、支援機型、API、3D模型、進階版，都移除
- [已修改] 右側進階面板的所有欄位都整併到「簡易」面板中，[簡易]改名稱為[參數] 

---

- [已修改] 右側面板的重疊率改名為[重疊率(路徑間距)]，使用者框線的最窄邊界(考慮旋轉角度)即為最大路徑間距；若範圍最窄僅 10m，間距自動上限 10m，超過則被限制。
- [已修改] 路徑間距欄位移動到重疊率拉桿下方，數字輸入與百分比拉桿雙向同步；拉桿改為具刻度（阻尼感），每 5% 一段並即時回推對應間距。
- [已修改] 產生路徑按鈕改為「即時更新」邏輯：調整重疊率、路徑間距、旋轉角度即自動重算路徑，不需再手動點擊；按鈕移至下載分頁僅保留「手動重算」與使用者提示。

---

- [已修改] 品質與路徑區塊下方新增「預估飛行時間 00:00:00」文字，依航點總距離與速度估算；下載分頁同步顯示。
- [已修改] 多邊形框線時，節點 1-2 固定貼在使用者第一條邊上（以首兩點決定邊向），並隨旋轉角度一起旋轉，保持起始線經過邊界。
- [已修改] 移除左側選單的「儲存」「載入」按鈕與對應程式邏輯。
- [已修改] 下載單元移除「儲存任務至帳號」、移除分割任務切換，預估時間同步顯示；保留 KMZ 下載與自動安裝程式指引文字。
- [已修改] 多邊形模式下，起始線以第一條邊為基準，旋轉 0°~360° 時保持經過該邊；（第一條邊為首兩點）。
- [已修改] 間距與重疊：重疊率限制 20-95%，維持與間距雙向同步。

---
- [已修改、未完成] 興趣點：維持點到點依序飛行，不再嘗試閉合；重複點不會構成多邊形，僅顯示順序折線供審視。
- [已修改、未完成] POI 圓形：繪製圓後自動生成沿圓周的航線，節點間距可由路徑間距設定決定，每個節點機頭朝向圓心，畫面不再空白。

- [未修改] 操作步驟：
開啟畫面後
1.點擊關閉「開始繪製區域」提示
2.點擊多邊形，畫完一個多邊形
3.點擊Reset
4.再次出現「開始繪製區域」：這裡修改成不會再次出現
5.左側選單還是選定多邊形的狀態，問題出在於此時無法在繼續繪製多邊形

使用者在第3步驟是希望重新繪製的，因此要回到剛點及多邊形的情況可以立即開始繪製

以上問題請進行優化
---



# UI 介面與後端邏輯修正分析 (DJI 合規性)

根據 DJI 技術文件與目前系統現況，以下將修正項目分為「需新增 UI 介面」與「僅需後端邏輯補強」兩類：

## 1. 需新增 UI 介面 (前端 PropertiesPanel.tsx & types.ts)

以下參數目前在介面上不存在，需新增欄位供使用者設定：

- [待確認] **安全高度 (Takeoff Security Height)**
    - **位置**：[參數] 分頁 -> [飛行參數] 區塊
    - **欄位**：數字輸入框 (單位：m)
    - **說明**：設定起飛安全高度 (1.5m - 1500m)，對應 `wpml:takeOffSecurityHeight`。

- [待確認] **過渡速度 (Global Transitional Speed)**
    - **位置**：[參數] 分頁 -> [飛行參數] 區塊
    - **欄位**：數字輸入框 (單位：m/s)
    - **說明**：飛往首航點或斷點續飛的速度，對應 `wpml:globalTransitionalSpeed`。

- [待確認] **失控行為 (RC Lost Action)**
    - **位置**：[參數] 分頁 -> [進階選項] 區塊
    - **欄位**：下拉選單
    - **選項**：
        - 繼續執行 (Go Continue)
        - 執行失控動作 (Execute Lost Action) -> 需連動選擇：返航/降落/懸停
    - **說明**：對應 `wpml:exitOnRCLost` 與 `wpml:executeRCLostAction`。

- [待確認] **進場模式 (Fly To Wayline Mode)**
    - **位置**：[參數] 分頁 -> [進階選項] 區塊
    - **欄位**：下拉選單
    - **選項**：
        - 安全模式 (Safely) - 預設
        - 點對點 (Point to Point)
    - **說明**：決定如何飛往第一航點，對應 `wpml:flyToWaylineMode`。

- [待確認] **高度模式 (Execute Height Mode)**
    - **位置**：[參數] 分頁 -> [飛行參數] 區塊
    - **欄位**：下拉選單
    - **選項**：
        - 相對起飛點 (Relative to Start Point) - 預設
        - WGS84 (Ellipsoid Height)
        - 地表跟隨 (Real-time Follow Surface)
    - **說明**：對應 `wpml:executeHeightMode`。

## 2. 僅需後端邏輯補強 (utils/flightPathUtils.ts)

以下項目無需新增 UI，可透過現有參數轉換或使用預設值：

- [已修改] **KMZ 封裝結構**
    - **邏輯**：需實作 ZIP 壓縮邏輯，將生成的 KML 封裝為 `wpmz/template.kml`，並額外生成 `wpmz/waylines.wpml`。
    - **來源**：現有路徑資料。

- [已修改] **Wayline ID 與 Template ID**
    - **邏輯**：自動生成唯一的 ID (如 0, 1, 2...)。
    - **來源**：系統自動產生。

- [已修改] **航點索引 (wpml:index)**
    - **邏輯**：確保輸出的 XML 中 `wpml:index` 從 0 開始連續遞增。
    - **來源**：現有 `waypoints` 陣列索引。

- [已修改] **轉彎模式 (wpml:waypointTurnParam)**
    - **邏輯**：若使用者未設定 (目前無 UI)，預設使用 `coordinateTurn` (協調轉彎) 或 `toPointAndStop` (直線飛行，對應現有 `straightenPaths` 設定)。
    - **來源**：現有 `straightenPaths` 參數。

- [已修改] **動作組格式轉換**
    - **邏輯**：將現有的 `actionType` (photo/none) 轉換為 WPML 的 `wpml:actionGroup` XML 結構。
    - **來源**：現有 `actionType` 與 `interval` 參數。
